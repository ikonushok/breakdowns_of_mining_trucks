Для решения задачи предсказания ранней деградации ТНВД/форсунок на горных самосвалах БелАЗ 75306 необходимо выполнить несколько шагов предобработки данных. Важно правильно подготовить данные, чтобы модель могла эффективно обнаруживать аномалии и предсказывать возможные отказы. Вот детализированный план предобработки данных:

---

### 1. **Объединение данных**

* **Данные телеметрии** (`telemetry_df.parquet`): Все данные о топливной системе, такие как `rail_pressure`, `fuel_rate`, `EGT`, `engine_rpm`, `engine_load`, `coolant_temp`, `oil_temp`, `torque`, и другие, должны быть объединены в единый датафрейм с помощью `timestamp`, чтобы можно было отслеживать изменения по времени.
* **Данные по обслуживанию**: Включите информацию о событиях обслуживания из таблицы `oil_lab_df.parquet` и `idles.parquet` для определения случаев ремонта или обслуживания и использования их как метки для будущих отказов.

### 2. **Преобразование времени**

* Убедитесь, что временные метки (`timestamp`) имеют правильный формат. Преобразуйте их в формат datetime для правильной агрегации данных и построения временных рядов.
* Если нужно, агрегируйте данные по временным интервалам (например, по часам или дням), чтобы модель могла анализировать тренды в данных на протяжении времени.

### 3. **Формирование меток для прогноза**

Мы не предсказываем “факт отказа”,
а вероятность, что в ближайшие N дней будет fuel_degradation.

**Окна**

Для каждого события fuel_degradation:
- [-30, -7] дней → label = 1 (деградация)
- [-7, 0] → лучше выкинуть (слишком поздно)
- [< -30] → label = 0 (норма)

### 4. **Обработка пропущенных значений**

* Заполните пропущенные значения (если они есть) с помощью статистических методов (например, среднее, медиана, или с использованием более сложных техник заполнения, таких как линейная интерполяция).
* Пропущенные данные, связанные с критически важными параметрами, такими как `rail_pressure`, `fuel_rate`, `EGT`, должны быть обработаны с особым вниманием, так как они являются ключевыми для предсказания деградации.

### 5. **Создание дополнительных признаков**

* **Пульсации давления**: Для предсказания деградации ТНВД/форсунок важно учитывать пульсации в давлении на топливной рампе. Используйте **спектральный анализ** (например, быстрые преобразования Фурье или вейвлет-преобразования), чтобы извлечь информацию о частотных компонентах пульсаций давления. Это поможет создать признаки, которые описывают колебания давления в рампе.
* **Дрейф расхода топлива при фиксированной нагрузке**: Рассчитайте тренды расхода топлива относительно нагрузки/крутящего момента. Используйте методы для вычисления **градиента расхода топлива** и его изменения.
* **Асимметрия EGT**: Для температур выхлопных газов можно вычислить **асимметрию** между коллекторами/банками, что может быть признаком неравномерной работы форсунок.
* **Скользящие средние и оконные статистики**: Для всех ключевых параметров (например, `rail_pressure`, `fuel_rate`, `EGT`, `engine_rpm`) вычисляйте **скользящие средние**, **медианы** и **стандартные отклонения** за заданные интервалы времени (например, 30 минут или 1 час).
* **Тренды и изменения**: Рассчитайте **градиенты** изменения параметров во времени (например, изменение давления, температуры, расхода топлива).

### 6. **Нормализация и стандартизация**

* Примените нормализацию или стандартизацию для числовых признаков (например, **MinMaxScaler** или **StandardScaler**) для того, чтобы значения признаков находились в одном масштабе. Это особенно важно для моделей, таких как градиентный бустинг и нейронные сети.

### 7. **Отбор признаков**

* Примените методы для отбора значимых признаков. Используйте **корреляцию** между признаками и целевой переменной для того, чтобы отобрать только самые важные признаки.
* Примените **методы отбора признаков** на основе важности (например, с использованием градиентного бустинга или случайного леса), чтобы оставить наиболее информативные параметры для классификации.

### 8. **Формирование обучающего и тестового наборов данных**

* Разделите данные на обучающие и тестовые наборы, соблюдая принцип временного разбиения (train до определенной даты, test после).
* Используйте **кросс-валидацию** (например, **GroupKFold** по технике) для того, чтобы избежать утечек данных при обучении модели.

### 9. **Создание модели**

* **Модель аномалий**: Используйте **Isolation Forest** или **Autoencoder** для выявления аномальных паттернов в данных. Эти модели помогут выявить необычные поведения системы, которые могут быть признаком деградации ТНВД/форсунок.
* **Градиентный бустинг**: После выделения аномалий, примените модели классификации, такие как **Gradient Boosting** (LightGBM или XGBoost) для предсказания вероятности отказа или необходимости обслуживания.
* Рассмотрите возможность использования **кластеризации** (например, K-Means) для группировки похожих режимов работы техники и выявления аномалий внутри каждого кластера.

### 10. **Оценка модели**

* Для оценки точности модели используйте метрики **AUROC**, **PR-AUC** для оценки качества классификации и прогнозирования.
* Оцените **среднее опережение** (например, среднее количество дней до фактического события отказа), чтобы убедиться, что модель может предсказать деградацию заранее.
* Используйте метрики, такие как **Precision@k**, для оценки точности с учетом фиксированного уровня Recall (например, 80%).

### 11. **Визуализация результатов**

* Создайте **дашборд** с прогнозами, который будет отображать:

  * **Риск деградации** для каждого самосвала на горизонте 7, 14, 30 дней.
  * **Графики трендов** для ключевых параметров, таких как давление в топливной рампе, расход топлива, температура и EGT.
* Используйте **графики вероятности отказа** и **скоринговые функции**, чтобы предоставить ясную информацию диспетчерам.

### 12. **Отчет и интеграция**

* Подготовьте отчет, в котором будет описан процесс обработки данных, построение модели, ее оценка и результаты.
* Интегрируйте модель в систему для реального времени, чтобы она могла предоставлять предсказания для диспетчеров и операторов.

Этот процесс предобработки данных обеспечит качественное обучение модели для раннего предсказания деградации топливной системы, что позволит значительно повысить эффективность работы и снизить количество неожиданных поломок.
